<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Cotización</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table { 
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #2196F3;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        input[type="number"] {
            width: 80px;
        }
        .price {
            text-align: right;
        }
        button {
            margin: 10px 0;
            padding: 10px;
        }
        #logo-img {
            display: none; /* Ocultar la imagen en la página */
        }
    </style>
</head>
<body>
    <h1>Generador de Cotización</h1>

    <!-- Precargar el logo en el HTML -->
    <img id="logo-img" src="https://via.placeholder.com/135x65" alt="Logo">

    <!-- Datos del cliente con folio -->
    <div>
        <label>Número de Folio: <input type="text" id="folio-number" placeholder="Folio"></label><br>
        <label>Nombre del Cliente: <input type="text" id="client-name" placeholder="Nombre del Cliente"></label><br>
        <label>Ciudad: <input type="text" id="client-city" placeholder="Ciudad"></label><br>
        <label>Teléfono: <input type="text" id="client-phone" placeholder="Teléfono"></label><br>
        <label>Email: <input type="text" id="client-email" placeholder="Email"></label><br>
    </div>

    <!-- Selección de ítems -->
    <div>
        <label>Agregar Ítem: 
            <select id="item-select">
                <option value="">Selecciona un ítem</option>
            </select>
        </label>
        <button id="add-item-btn">Agregar</button>
    </div>

    <!-- Tabla de ítems -->
    <table id="items">
        <thead>
            <tr>
                <th>Unidad</th>
                <th>Concepto</th>
                <th>Vehículo</th>
                <th>P.U.</th>
                <th>Precio</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Impuestos y total -->
    <div>
        <label>Impuestos (%): <input type="number" id="tax" value="0" onchange="calculateTotal()"></label><br>
        <strong>Total: <span id="total">$0.00</span></strong>
    </div>

    <!-- Botón para descargar PDF -->
    <button onclick="downloadPDF()">Descargar PDF</button>

    <!-- Incluir jsPDF y autoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;

        const items = [
            "AUTOBUS 45 PLAZAS", "CAMIONETA CARGA", "CAMIONETA VAN", "COMIDAS DEL OPERADOR",
            "COMISION BANCARIA 0.5%", "COORDINADOR", "DERECHOS DE PISO", "HORAS EXTRA",
            "HOSPEDAJE", "MINIBUS 31 PLAZAS", "PARKING", "SEDAN", "SPRINTER", "SUBURBAN",
            "SUBURBAN ADVANCE", "SUBURBAN BLINDADA NIVEL 3", "SUBURBAN HIGW COUNTRY",
            "SUBURBAN LINEA ANTIGUA", "TOYOTA HIENCE", "TRAMO CARRETERO", "VAN DE CARGA", "VIATICOS"
        ];

        const itemsContainer = document.querySelector('#items tbody');
        const itemSelect = document.getElementById('item-select');

        // Llenar el menú desplegable con los conceptos
        items.forEach(item => {
            const option = document.createElement('option');
            option.value = item;
            option.textContent = item;
            itemSelect.appendChild(option);
        });

        // Agregar evento al botón "Agregar"
        document.getElementById('add-item-btn').addEventListener('click', addItem);

        function addItem() {
            const selectedItem = itemSelect.value;
            if (selectedItem) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="number" placeholder="Cantidad" class="unit" onchange="calculateTotal()"></td>
                    <td>Servicio de Transportación Ejecutiva</td>
                    <td>${selectedItem}</td>
                    <td><input type="number" placeholder="P.U." class="unit-price" onchange="calculateTotal()"></td>
                    <td class="price">$0.00</td>
                `;
                itemsContainer.appendChild(row);
                itemSelect.value = '';
            } else {
                alert('Por favor, selecciona un ítem antes de agregar.');
            }
        }

        function calculateTotal() {
            let total = 0;
            const rows = document.querySelectorAll('#items tbody tr');
            rows.forEach(row => {
                const unitInput = parseFloat(row.querySelector('.unit').value) || 0;
                const unitPriceInput = parseFloat(row.querySelector('.unit-price').value) || 0;
                const priceCell = row.querySelector('.price');
                const price = unitInput * unitPriceInput;
                priceCell.textContent = `$${price.toFixed(2)}`;
                total += price;
            });
            const taxRate = parseFloat(document.getElementById('tax').value) || 0;
            total += total * (taxRate / 100);
            document.getElementById('total').innerText = `$${total.toFixed(2)}`;
        }

        function downloadPDF() {
            const doc = new jsPDF();

            // Obtener la imagen precargada del HTML
            const logo = document.getElementById('logo-img');

            // Generar el contenido del PDF con el logo
            generatePDFContent(doc, logo);
            doc.save("cotizacion_richy_entertainment.pdf");
        }

        function generatePDFContent(doc, logo) {
            // Configuración general
            doc.setFont("Helvetica", "normal");
            doc.setTextColor(33, 33, 33);

            // Agregar el logo en la parte superior
            if (logo) {
                const pageWidth = doc.internal.pageSize.getWidth();
                const logoWidth = 135;
                const logoHeight = 65;
                const x = (pageWidth - logoWidth) / 2; // Centrado horizontalmente
                doc.addImage(logo, 'JPEG', x, 10, logoWidth, logoHeight); // Logo en la parte superior
            }

            // Encabezado simple (sin fondo azul para simplificar)
            doc.setFontSize(8);
            doc.text(`Fecha: ${new Date().toLocaleDateString('es-MX')}`, 10, 20);
            const folio = document.getElementById('folio-number').value || 'Sin Folio';
            doc.setFontSize(10);
            doc.text(`Folio: ${folio}`, 170, 20);

            // Tabla de ítems
            let y = 80; // Espacio para el logo
            const tableData = [];
            const rows = document.querySelectorAll('#items tbody tr');
            rows.forEach(row => {
                const unit = row.querySelector('.unit').value || '';
                const concept = 'Servicio de Transportación Ejecutiva';
                const vehicle = row.cells[2].textContent;
                const unitPrice = row.querySelector('.unit-price').value || '';
                const price = row.querySelector('.price').textContent || '$0.00';
                if (unit && unitPrice && price !== '$0.00') {
                    tableData.push([unit, concept, vehicle, unitPrice, price]);
                }
            });

            doc.autoTable({
                head: [['Unidad', 'Concepto', 'Vehículo', 'P.U.', 'Precio']],
                body: tableData,
                startY: y,
                theme: 'grid',
                styles: { fontSize: 8, font: "Helvetica", textColor: [33, 33, 33] },
                headStyles: { fillColor: [33, 150, 243], textColor: [255, 255, 255], fontSize: 9, fontStyle: "bold" },
                margin: { top: 80 }
            });

            // Posición después de la tabla
            y = doc.lastAutoTable.finalY + 10;

            // Impuestos y Total (sin cuadro estilizado)
            const taxRate = document.getElementById('tax').value || 0;
            const total = document.getElementById('total').innerText;
            doc.setFontSize(10);
            doc.text(`Impuestos: ${taxRate}%`, 10, y);
            y += 8;
            doc.text(`Total: ${total}`, 10, y);

            // Datos del cliente y vendedor (sin fondos estilizados)
            y += 10;
            const clientName = document.getElementById('client-name').value || 'Nombre del Cliente';
            const clientCity = document.getElementById('client-city').value || 'Ciudad';
            const clientPhone = document.getElementById('client-phone').value || 'Teléfono';
            const clientEmail = document.getElementById('client-email').value || 'Email';

            doc.setFontSize(9);
            doc.text("Datos del Cliente", 10, y);
            y += 5;
            doc.text(`Nombre: ${clientName}`, 10, y);
            y += 5;
            doc.text(`Ciudad: ${clientCity}`, 10, y);
            y += 5;
            doc.text(`Teléfono: ${clientPhone}`, 10, y);
            y += 5;
            doc.text(`Email: ${clientEmail}`, 10, y);

            y += 10;
            doc.text("Datos del Vendedor", 10, y);
            y += 5;
            doc.text("RICHY ENTERTAINMENT S.A.S. DE C.V.", 10, y);
            y += 5;
            doc.text("CDMX", 10, y);
            y += 5;
            doc.text("52 55 7341 3969", 10, y);
            y += 5;
            doc.text("transpo_rick@hotmail.com", 10, y);

            y += 10;
            doc.text("Información Bancaria", 10, y);
            y += 5;
            doc.text("Banco: Santander", 10, y);
            y += 5;
            doc.text("Nombre: Richy Entertainment, SAS de CV", 10, y);
            y += 5;
            doc.text("Cuenta No.: 65-51041870-7", 10, y);
            y += 5;
            doc.text("Clabe Interbancaria: 014180655104187070", 10, y);

            // Logo en el pie de página (índice de la página)
            if (logo) {
                const pageHeight = doc.internal.pageSize.getHeight();
                doc.addImage(logo, 'JPEG', 10, pageHeight - 20, 30, 14); // Logo pequeño en la esquina inferior izquierda
            }

            // Pie de página simplificado
            doc.setFontSize(8);
            doc.text("© 2025 Richy Entertainment S.A.S. de C.V.", 50, pageHeight - 10);
        }
    </script>
</body>
</html>
